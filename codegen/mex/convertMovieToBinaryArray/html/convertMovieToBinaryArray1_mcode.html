<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T22U3">binArray</span> = convertMovieToBinaryArray(<span class="var type1" id="S3T1U6">mov_struct</span>) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% declare rgb2gray extrinsic, meaning that it stays a matlab function</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line">coder.extrinsic(<span class="string">'rgb2gray'</span>, <span class="string">'imabsdiff'</span>, <span class="string">'graythresh'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="var type1" id="S5T3U17">mov</span> = <span class="var type1" id="S3T1U19">mov_struct</span>.frames;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="var type1" id="S6T8U23">new_mov</span> = zeros([size(<span class="var type1" id="S5T3U32">mov</span>(1).cdata,1) size(<span class="var type1" id="S5T3U40">mov</span>(1).cdata,2) length(<span class="var type1" id="S5T3U46">mov</span>)], <span class="string">'uint8'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"> <span class="keyword">for</span> <span class="var type1" id="S10T2U50">ii</span>=1:length(<span class="var type1" id="S5T3U55">mov</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">     <span class="var type1" id="S6T8U59">new_mov</span>(:,:,<span class="var type1" id="S10T2U62">ii</span>) = rgb2gray(<span class="var type1" id="S5T3U67">mov</span>(<span class="var type1" id="S10T2U68">ii</span>).cdata);</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"> <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="comment">% make a movie from the average frame to subtract</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="var type1" id="S12T15U72">avg_frame</span> = uint8(round(mean(<span class="var type1" id="S6T8U79">new_mov</span>,3)));</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="var type1" id="S16T8U83">avg_mov</span> = repmat(<span class="var type1" id="S12T15U86">avg_frame</span>, [1 1 length(<span class="var type1" id="S5T3U93">mov</span>)]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="var type2" id="S18T0U96">mean_sub_mov</span> = zeros(size(<span class="var type1" id="S6T8U101">new_mov</span>)); <span class="comment">% need to declare the array so that the MATLAB lets me index it later</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="var type1" id="S18T19U104">mean_sub_mov</span> = imabsdiff(<span class="var type1" id="S6T8U107">new_mov</span>, <span class="var type1" id="S16T8U108">avg_mov</span>); <span class="comment">%this should give a nice moving blob.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="var type1" id="S2T8U111">binArray</span> = zeros(size(<span class="var type1" id="S18T19U116">mean_sub_mov</span>), <span class="string">'uint8'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="var type2" id="S20T0U120">nFrames</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="var type1" id="S21T20U124">thresh</span> = graythresh(<span class="var type1" id="S18T19U127">mean_sub_mov</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="var type1" id="S20T21U130">nFrames</span> = int16(size(<span class="var type1" id="S2T8U135">binArray</span>,3));</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S10T21U139">ii</span> = int16(1):<span class="var type1" id="S20T21U144">nFrames</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    <span class="var type2" id="S2T0U148">binArray</span>(:,:,<span class="var type2" id="S10T0U151">ii</span>) = <span class="message fatal" id="M1F1C">im2bw</span>(<span class="var type1" id="S18T19U155">mean_sub_mov</span>(:,:,<span class="var type1" id="S10T21U158">ii</span>), <span class="var type1" id="S21T20U159">thresh</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="var type2" id="S2T0U162">binArray</span> = <span class="var type2" id="S2T0U164">binArray</span> * 255;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="keyword">return</span>;</span></span>
</pre>
